{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">

    <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© -->
    <h2 class="text-center text-success">
        ğŸ’³ {% if language == 'ar' %} Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± PayPal {% else %} PayPal Payment {% endif %}
    </h2>

    <!-- ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <div class="alert alert-info text-center">
        {% if language == 'ar' %}
            ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ø¹Ù…Ù„Ø© ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù† Ù„Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± PayPal.
        {% else %}
            Please select the amount, currency, payment method, and shipping method to complete the PayPal payment.
        {% endif %}
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯ÙØ¹ -->
    <form id="payment-form" method="post" action="{% url 'create_payment' %}" novalidate>
        {% csrf_token %}

        <!-- Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº -->
        <div class="form-group">
            <label for="amount">ğŸ’° 
                {% if language == 'ar' %} Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø¯ÙØ¹Ù‡ {% else %} Amount to be paid {% endif %}
            </label>
            <input type="number" id="amount" name="amount" class="form-control"
                   placeholder="{% if language == 'ar' %} Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº {% else %} Enter amount {% endif %}"
                   required min="1" step="0.01">
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù…Ù„Ø© -->
        <div class="form-group mt-3">
            <label for="currency">ğŸŒ 
                {% if language == 'ar' %} Ø§Ù„Ø¹Ù…Ù„Ø© {% else %} Currency {% endif %}
            </label>
            <select id="currency" name="currency" class="form-control text-capitalize" required>
                <option value="USD">ğŸ’µ Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                <option value="DZD">ğŸ‡©ğŸ‡¿ Ø¯ÙŠÙ†Ø§Ø± Ø¬Ø²Ø§Ø¦Ø±ÙŠ (DZD)</option>
            </select>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ -->
        <div class="form-group mt-3">
            <label for="payment_method">ğŸ’³ 
                {% if language == 'ar' %} Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ {% else %} Payment Method {% endif %}
            </label>
            <select id="payment_method" name="payment_method" class="form-control text-capitalize" required>
                {% for method in payment_methods %}
                    <option value="{{ method.name }}">{{ method.name }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù† -->
        <div class="form-group mt-3">
            <label for="shipping_method">ğŸšš 
                {% if language == 'ar' %} Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø´Ø­Ù† {% else %} Shipping Method {% endif %}
            </label>
            <select id="shipping_method" name="shipping_method" class="form-control text-capitalize" required>
                {% for method in shipping_methods %}
                    <option value="{{ method.id }}">
                        {{ method.name }} - {{ method.price }} Ø¯Ø¬
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Ø²Ø± Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ -->
        <button type="submit" class="btn btn-primary mt-3 w-100">
            ğŸ›’ {% if language == 'ar' %} Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ {% else %} Complete Payment {% endif %}
        </button>
    </form>

    <!-- Ø²Ø± PayPal -->
    <div id="paypal-button-container" class="mt-4 text-center"></div>

    <!-- Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© -->
    <p class="mt-4 text-muted text-center">
        {% if language == 'ar' %}
            Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠ Ø¹Ù†Ø¯ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¯ÙŠÙ†Ø§Ø± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.
        {% else %}
            The amount will be automatically converted to USD when using DZD.
        {% endif %}
    </p>

</div>

<!-- ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        paypal.Buttons({
            createOrder: function(data, actions) {
                let amount = document.getElementById('amount').value;
                let currency = document.getElementById('currency').value;

                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: amount,
                            currency_code: currency
                        }
                    }]
                });
            },
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                    alert('âœ… Ø§Ù„Ø¯ÙØ¹ Ù†Ø§Ø¬Ø­! Ø´ÙƒØ±Ø§ Ù„ÙƒØŒ ' + details.payer.name.given_name);

                    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
                    let form = document.getElementById('payment-form');
                    form.submit();
                });
            },
            onError: function(err) {
                console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¯ÙØ¹:", err);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
            }
        }).render('#paypal-button-container');
    });
</script>

{% endblock %